
<!DOCTYPE html>
<html>

<head>

	<style>
		* {
			padding: 0;
			margin: 0;
		}
		
		canvas {
			background: black;
			display: block;
			margin: 0 auto;
		}
	</style>

<title>Land Generator</title>
</head>

<body>

	<canvas id="myCanvas" width="1350" height="630"></canvas>

	<body style="background-color:black;">

		<SCRIPT LANGUAGE="JavaScript">
			
			
			var canvas = document.getElementById("myCanvas");
			var ctx = canvas.getContext("2d");
			
			var tile = [[]];
			
			var index1, index2;
			
			
			//var seed = 0;
			var camera = {x:0,y:0};
			
			var tileSize = 10;
			var mapSize = {x:Math.floor(1000/tileSize),y:Math.floor(600/tileSize)};
			var slope = 2;  //maximum land slope
			var maxHeight = 30;
			var waterHeight = 15;
			
			var tilesLeft = 0;//mapSize.x * mapSize.y;
			var count = 0;
			
			for(index1 = 0;index1 < mapSize.x;index1++){
				tile[index1] = [];
				for(index2 = 0;index2 < mapSize.y;index2++){
					tile[index1][index2] = 0;
				}
			}
			
			
			
			
			
			
			function distance(x1,y1,x2,y2){
				return Math.sqrt((x1-x2)**2 + (y1-y2)**2);
			}
			function gridDistance(x1,y1,x2,y2){
				return Math.abs(x1-x2) + Math.abs(y1-y2);
			}
			
			function randIntBetween(a,b){
				return a > b ? randIntBetween(b,a) : Math.floor(Math.random()*(b - a + 1)) + a;
			}
			
			
			
			document.addEventListener("keydown", keyDownHandler, false);
			//document.addEventListener("keyup", keyUpHandler, false);
			function keyDownHandler(e) {
				if(tilesLeft == 0){
					if(e.key == "ArrowUp"   ) camera.y -= mapSize.y/2;
					if(e.key == "ArrowDown" ) camera.y += mapSize.y/2;
					if(e.key == "ArrowLeft" ) camera.x -= mapSize.x/2;
					if(e.key == "ArrowRight") camera.x += mapSize.x/2;
					if(e.key == "g"){
						var c = {x:Math.max(-camera.x, 0),y:Math.max(-camera.y, 0)};
						/*if(!(c.x == 0 && c.y == 0)){
							var t = tile;
							for(;;){
								
							}
						}*/
						
						
						
						
						for(index1 = camera.x;index1 < camera.x + mapSize.x;index1++){
							if(typeof tile[index1] == "undefined") tile[index1] = [];
							for(index2 = camera.y;index2 < camera.y + mapSize.y;index2++){
								if(typeof tile[index1][index2] == "undefined") tile[index1][index2] = 0;
								if(tile[index1][index2] == 0) tilesLeft++;
							}
						}
						//tilesLeft = 1000; //temp
					}
				}
			}
			
			
			function draw() {
				
				
				
				if(tilesLeft > 0){
					for(var i = 0;i<100;i++){
						count = Math.random()*tilesLeft;
						for(index1 = camera.x;index1 < camera.x + mapSize.x && count > 0;index1++){
							for(index2 = camera.y;index2 < camera.y + mapSize.y && count > 0;index2++){
								if(tile[index1][index2] == 0){
									count--;
									if(count <= 0) var rand = {x:index1,y:index2};
								}
							}
						}
						var bounds = {top:maxHeight,bottom:1};
						for(index1 = Math.max(0, Math.floor(rand.x - maxHeight/slope));index1 < Math.min(mapSize.x, Math.floor(rand.x + maxHeight/slope));index1++){
							for(index2 = 0;index2 < mapSize.y;index2++){
								if(tile[index1][index2] != 0){
									bounds.bottom = Math.max(bounds.bottom, tile[index1][index2] - distance(index1, index2, rand.x, rand.y) * slope);
									bounds.top    = Math.min(bounds.top   , tile[index1][index2] + distance(index1, index2, rand.x, rand.y) * slope);
								}
							}
						}
						tile[rand.x][rand.y] = randIntBetween(bounds.bottom, bounds.top);
						tilesLeft--;
					}
				}
				
				
				ctx.clearRect(0,0,canvas.width,canvas.height);
				for(index1 in tile){
					for(index2 in tile[index1]){
						ctx.beginPath();
						ctx.fillStyle = tile[index1][index2] == 0 ? "black" : "rgb(0," + Math.floor(tile[index1][index2]*(155/maxHeight) + 100) + "," + (tile[index1][index2] <= waterHeight ? Math.floor(tile[index1][index2]*(155/maxHeight) + 100) : 0) + ")";
						ctx.fillRect((index1 - camera.x)*tileSize, (index2 - camera.y)*tileSize, tileSize, tileSize);
						ctx.closePath();
					}
				}
				
				
				
				setTimeout(draw, 20);
			}    
			draw();
        		
   		 </SCRIPT>
	</body>
</html>
