
<!DOCTYPE html>
<html>

<head>

	<style>
		* {
			padding: 0;
			margin: 0;
		}
		
		canvas {
			background: goldenrod;
			display: block;
			margin: 0 auto;
		}
	</style>

<title>The game of Go</title>
</head>

<body>

	<canvas id="myCanvas" width="700" height="620"></canvas>

	<body style="background-color:saddleBrown;">

		<SCRIPT LANGUAGE="JavaScript">
			
			
			var canvas = document.getElementById("myCanvas");
			var ctx = canvas.getContext("2d");
			
			
			var sizeSelect = 1;
			
			var boardSize = 5; //9,13,19
			var scale = 600/boardSize;
			
			
			var index1 = 0;
			var index2 = 0;
			var index3 = 0;
			var index4 = 0;
			var adjacent = [{x:1,y:0},{x:0,y:1},{x:-1,y:0},{x:0,y:-1}];
			
			var tile = [[]];
			var tilesMarked = 0;
			var blobCheck = 0;
			
			var selected = {x:0,y:0};
			
			
			var lastTile = [[]];
			var undid = 0;
			var nestIfs = 0;
			
			var a = {start:[], end:[], loop:[], condition:[], statement:[]};
			a.start = ["","tilesMarked = 0;","blobCheck = 0;","tile[selected.x][selected.y].blob = 1;","blobCheck = 1;","tilesMarked = 1;","if(tilesMarked > 0){blobCheck = 1;}",
				   "tile[selected.x][selected.y].stone = turn;"];
			a.end = ["","if(tilesMarked > 0){blobCheck = 1;}","undid = 0;"];
			a.loop = [";tilesMarked > 0;","index1 = 0;index1 < boardSize;index1++","index2 = 0;index2 < boardSize;index2++","index3 = 0;index3 < 4;index3++"];
			a.condition = ["onBoard(index1 + adjacent[index3].x,index2 + adjacent[index3].y)","onBoard(selected.x + adjacent[index3].x,selected.y + adjacent[index3].y)",
				       "tile[selected.x][selected.y].stone + tile[selected.x + adjacent[index3].x][selected.y + adjacent[index3].y].stone == 3",
				       "tile[selected.x + adjacent[index3].x][selected.y + adjacent[index3].y].blob == 0",
				       "tile[index1][index2].stone == tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].stone","tile[index1][index2].blob == 1",
				       "tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].blob == 0","tile[index1][index2].stone == 0",
				       "tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].blob == 1","tile[index1][index2].safe == 1",
				       "tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].safe == 0","tile[index1][index2].safe == 0"];
			a.statement = ["tilesMarked++;","tile[selected.x + adjacent[index3].x][selected.y + adjacent[index3].y].blob = 1;",
				       "tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].blob = 1;","tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].safe = 1;",
				       "tile[index1][index2].stone = 0;","lastTile[index1][index2].stone = tile[index1][index2].stone;"];
			
			
			var turn = 1;
			var teamColor = ["","Black","White"];
			
			var winner = 0;
			var score = ["",0,0];
			
			var box = [0,0];
			
			
			/*
			var mod = function (n, m) {
				var remain = n % m;
				return Math.floor(remain >= 0 ? remain : remain + m);
			};*/
			
			
			
			function createBoard(){
				for(index1 = 0; index1 < boardSize; index1++){
					tile[index1] = [];
					for(index2 = 0; index2 < boardSize; index2++){
						
						tile[index1][index2] = {
							stone: 0,
							blob: 0,
							safe:0,
							
							scoreBlob1:0,
							scoreBlob2:0
						}
					}
				}
				for(index1 = 0; index1 < boardSize; index1++){
					lastTile[index1] = [];
					for(index2 = 0; index2 < boardSize; index2++){
						lastTile[index1][index2] = {stone: 0}
					}
				}
				sizeSelect = 0;
			}
			
			
			
			
			function getMousePos(canvas, evt) {
			    var rect = canvas.getBoundingClientRect();
			    return {
			      x: Math.floor(((evt.clientX - rect.left) - 50)/scale),
			      y: Math.floor(((evt.clientY - rect.top) - 10)/scale)
			    };
			}
			
			function onBoard(x,y){
				return (x >= 0 && x < boardSize && y >= 0 && y < boardSize) ? true : false;
				//if(x >= 0 && x < boardSize && y >= 0 && y < boardSize){return true;}
				//else{return false;}
			}
			
			
			
			function spreadTile(layer, start, end, loop, condition, statement){  //start, end, loop, condition, and statement are arrays, start and end are 2D
				if(layer < start.length){
					for(index4 = 0;index4 < start[layer].length;index4++){
						eval(a.start[start[layer][index4]]);
					}
				}
				if(layer < loop.length){
					eval("for(" + a.loop[loop[layer]] + "){spreadTile(" + (layer + 1) + ", start, end, loop, condition, statement);}");
				}
				else{
					nestIfs = 1;
					for(index4 = 0;index4 < condition.length;index4++){
						eval("if(!(" + a.condition[condition[index4]] + ")){ nestIfs = 0;}");
						if(nestIfs == 0){break;}
					}
					if(nestIfs == 1){
						for(index4 = 0;index4 < statement.length;index4++){
							eval(a.statement[statement[index4]]);
						}
					}
				}
				if(layer < end.length){
					for(index4 = 0;index4 < end[layer].length;index4++){
						eval(a.end[end[layer][index4]]);
					}
				}
			}
			
			
			function addStone(evt) {
				
				
				
				if(sizeSelect == 1){
					
					var rect = canvas.getBoundingClientRect();
					selected = {x: Math.floor(evt.clientX - rect.left), y: Math.floor(evt.clientY - rect.top)};
					
					if(selected.y >= canvas.height/2 - 50 && selected.y <= canvas.height/2 + 50){
						boardSize = Math.floor((selected.x - canvas.width/2 + 250)/100);
						switch(boardSize){
						    case 0:
							boardSize = 9;
							scale = 600/boardSize;
							createBoard();
							break;
						    case 2:
							boardSize = 13;
							scale = 600/boardSize;
							createBoard();
							break;
						    case 4:
							boardSize = 19;
							scale = 600/boardSize;
							createBoard();
							break;
						    default:
							break;
						}
					}
				}
				else{

					selected = getMousePos(canvas, evt);

					if(onBoard(selected.x,selected.y) && tile[selected.x][selected.y].stone == 0  &&  winner == 0){

						//save board



						spreadTile(0,[[]],[[2]],[1,2],[],[5]);
						/*for(index1 = 0; index1 < boardSize; index1++){
							for(index2 = 0; index2 < boardSize; index2++){
								lastTile[index1][index2].stone = tile[index1][index2].stone;
							}
						}
						undid = 0;*/

						
						spreadTile(0,[[7,1]],[[]],[3],[1,2,3],[1,0]);

						/*tile[selected.x][selected.y].stone = turn;
						tilesMarked = 0;

						for(index3 = 0;index3 < 4;index3++){
							if(onBoard(selected.x + adjacent[index3].x,selected.y + adjacent[index3].y) &&
							   tile[selected.x][selected.y].stone + tile[selected.x + adjacent[index3].x][selected.y + adjacent[index3].y].stone == 3 &&
							   tile[selected.x + adjacent[index3].x][selected.y + adjacent[index3].y].blob == 0){
								tile[selected.x + adjacent[index3].x][selected.y + adjacent[index3].y].blob = 1;
								tilesMarked += 1;
							}
						}*/


						spreadTile(0,[[2,6],[1]],[[],[1]],[0,1,2,3],[0,4,5,6],[2,0]);
						
						/*blobCheck = 0;
						if(tilesMarked > 0){blobCheck = 1;}

						while(tilesMarked > 0){
							tilesMarked = 0;

							for(index1 = 0; index1 < boardSize; index1++){
								for(index2 = 0; index2 < boardSize; index2++){

									for(index3 = 0;index3 < 4;index3++){
										if(onBoard(index1 + adjacent[index3].x,index2 + adjacent[index3].y) &&
										   tile[index1][index2].stone == tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].stone &&
										   tile[index1][index2].blob == 1 &&
										   tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].blob == 0){
											tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].blob = 1;
											tilesMarked += 1;
										}
									}
								}
							}
							if(tilesMarked > 0){blobCheck = 1;}
						}*/
						
						if(blobCheck == 1){
							spreadTile(0,[[]],[[]],[1,2,3],[0,7,8],[3,0]);
							
							/*for(index1 = 0; index1 < boardSize; index1++){
								for(index2 = 0; index2 < boardSize; index2++){

									for(index3 = 0;index3 < 4;index3++){
										if(onBoard(index1 + adjacent[index3].x,index2 + adjacent[index3].y) &&
										   tile[index1][index2].stone == 0 && tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].blob == 1){
											tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].safe = 1;
											tilesMarked += 1;
										}
									}
								}
							}*/
						}
						
						
						spreadTile(0,[[],[1]],[[]],[0,1,2,3],[0,4,8,9],[3,0]);
						
						/*while(tilesMarked > 0){
							tilesMarked = 0;

							for(index1 = 0; index1 < boardSize; index1++){
								for(index2 = 0; index2 < boardSize; index2++){

									for(index3 = 0;index3 < 4;index3++){
										if(onBoard(index1 + adjacent[index3].x,index2 + adjacent[index3].y) &&
										   tile[index1][index2].stone == tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].stone &&
										   tile[index1][index2].safe == 1 && tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].safe == 0){
											tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].safe = 1;
											tilesMarked += 1;
										}
									}
								}
							}
						}*/

						for(index1 = 0; index1 < boardSize; index1++){
							for(index2 = 0; index2 < boardSize; index2++){

								if(tile[index1][index2].blob == 1 && tile[index1][index2].safe == 0){
									tile[index1][index2].stone = 0;
								}
								tile[index1][index2].blob = 0;
								tile[index1][index2].safe = 0;
							}
						}


						//=============================================================================================================================================================================



						tile[selected.x][selected.y].blob = 1;
						blobCheck = 1;
						tilesMarked = 1;

						while(tilesMarked > 0){
							tilesMarked = 0;

							for(index1 = 0; index1 < boardSize; index1++){
								for(index2 = 0; index2 < boardSize; index2++){

									for(index3 = 0;index3 < 4;index3++){
										if(onBoard(index1 + adjacent[index3].x,index2 + adjacent[index3].y) &&
										   tile[index1][index2].stone == tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].stone &&
										   tile[index1][index2].blob == 1 && tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].blob == 0){
											tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].blob = 1;
											tilesMarked += 1;
										}
									}
								}
							}
							if(tilesMarked > 0){blobCheck = 1;}
						}

						if(blobCheck == 1){
							for(index1 = 0; index1 < boardSize; index1++){
								for(index2 = 0; index2 < boardSize; index2++){

									for(index3 = 0;index3 < 4;index3++){
										if(onBoard(index1 + adjacent[index3].x,index2 + adjacent[index3].y) &&
										   tile[index1][index2].stone == 0 && tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].blob == 1){
											tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].safe = 1;
											tilesMarked += 1;
										}
									}
								}
							}
						}

						while(tilesMarked > 0){
							tilesMarked = 0;

							for(index1 = 0; index1 < boardSize; index1++){
								for(index2 = 0; index2 < boardSize; index2++){

									for(index3 = 0;index3 < 4;index3++){
										if(onBoard(index1 + adjacent[index3].x,index2 + adjacent[index3].y) &&
										   tile[index1][index2].stone == tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].stone &&
										   tile[index1][index2].safe == 1 && tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].safe == 0){
											tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].safe = 1;
											tilesMarked += 1;
										}
									}
								}
							}
						}

						for(index1 = 0; index1 < boardSize; index1++){
							for(index2 = 0; index2 < boardSize; index2++){

								if(tile[index1][index2].blob == 1 && tile[index1][index2].safe == 0){
									tile[index1][index2].stone = 0;
								}
								tile[index1][index2].blob = 0;
								tile[index1][index2].safe = 0;
							}
						}








						turn = turn % 2 + 1;
					}
				}
			}
			
			function countScore() {
				
				for(index1 = 0; index1 < boardSize; index1++){
					for(index2 = 0; index2 < boardSize; index2++){
						tile[index1][index2].scoreBlob1 = 0;
						tile[index1][index2].scoreBlob2 = 0;
						if(tile[index1][index2].stone == 1){tile[index1][index2].scoreBlob1 = 1;}
						if(tile[index1][index2].stone == 2){tile[index1][index2].scoreBlob2 = 1;}
					}
				}
				
				
				
				tilesMarked = 1; 
				
				while(tilesMarked > 0){
					tilesMarked = 0;
					for(index1 = 0; index1 < boardSize; index1++){
						for(index2 = 0; index2 < boardSize; index2++){
								
							for(index3 = 0;index3 < 4;index3++){
								
								if(onBoard(index1 + adjacent[index3].x,index2 + adjacent[index3].y) &&
								   tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].stone == 0){
									if(tile[index1][index2].scoreBlob1 > tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].scoreBlob1){	
										tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].scoreBlob1 = 1;
										tilesMarked += 1;
									}
									if(tile[index1][index2].scoreBlob2 > tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].scoreBlob2){	
										tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].scoreBlob2 = 1;
										tilesMarked += 1;
									}
								}
							}
						}
					}
				}
				score[1] = 0;
				score[2] = 0;
				for(index1 = 0; index1 < boardSize; index1++){
					for(index2 = 0; index2 < boardSize; index2++){
						
						if(tile[index1][index2].scoreBlob1 + tile[index1][index2].scoreBlob2 == 1){
							score[1] += tile[index1][index2].scoreBlob1;
							score[2] += tile[index1][index2].scoreBlob2;
						}
					}
				}
				if(score[1] + score[2] > 0.9 * (boardSize*boardSize)){
					if (score[1] > score[2]){winner = 1;}
					if (score[1] < score[2]){winner = 2;}
					if (score[1] ==score[2]){winner = 3;}
				}
				
			}
			
			
			
			function draw(evt) {
				
				ctx.clearRect(0,0,canvas.width,canvas.height);
				
				
				
				
				
				
				document.addEventListener("keydown", keyDownHandler, false);
				//document.addEventListener("keyup", keyUpHandler, false);
				function keyDownHandler(e) {
					
					if(e.keyCode == 87){countScore();}
					
					if(e.keyCode == 85 && undid == 0){
						for(index1 = 0; index1 < boardSize; index1++){
							for(index2 = 0; index2 < boardSize; index2++){
								tile[index1][index2].stone = lastTile[index1][index2].stone;
							}
						}
						turn = 3 - turn;
						undid = 1;
					}
					if(e.keyCode == 80 && sizeSelect == 0){
						turn = 3 - turn;
					}
					
					
				}
				
				
				
				document.addEventListener("click", addStone);
				
				//window.oncontextmenu = function(){return false;}  //temporary for debugging
				
				
				
				
				
				
				
				
				
				if(sizeSelect == 0){
					
					ctx.beginPath();
					ctx.fillStyle = teamColor[turn];
					ctx.fillRect(20, 200, 10, 220);
					ctx.fillRect(670, 200, 10, 220);
					ctx.fill();
					ctx.closePath();
					
					
					// draw the squares
					for(index1 = 0; index1 < boardSize; index1++){
						
						ctx.beginPath();
						ctx.moveTo(index1*scale + scale/2 +50, 10  + scale/2);
						ctx.lineTo(index1*scale + scale/2 +50, 610 - scale/2);
						ctx.stroke();
						
						ctx.beginPath();
						ctx.moveTo(50  + scale/2, index1*scale + scale/2 + 10);
						ctx.lineTo(650 - scale/2, index1*scale + scale/2 + 10);
						ctx.stroke();
					}
					
					// draw the stones and dot markers
					for(index1 = 0; index1 < boardSize; index1++){
						for(index2 = 0; index2 < boardSize; index2++){
							
							//dots
							if(index1 == (boardSize - 1)/2 && index2 == index1 ||
							   boardSize >= 13 && (index1 == 3 || index1 == boardSize - 4) && (index2 == 3 || index2 == boardSize - 4) ||
							   boardSize >= 19 && (((index1 == 3 || index1 == boardSize - 4) && index2 == (boardSize - 1)/2) ||
							                       ((index2 == 3 || index2 == boardSize - 4) && index1 == (boardSize - 1)/2)
							                      )){
								ctx.beginPath();
								ctx.arc(index1*scale + scale/2 +50, index2*scale + scale/2 +10, scale*0.07, 0, Math.PI * 2);
								ctx.fillStyle = "black";
								ctx.fill();
								ctx.closePath();
							}
							
							//stones
							if(tile[index1][index2].stone > 0){
								ctx.beginPath();
								ctx.arc(index1*scale + scale/2 +50, index2*scale + scale/2 +10, scale*2/5, 0, Math.PI * 2);
								ctx.fillStyle = teamColor[tile[index1][index2].stone];
								ctx.fill();
								ctx.closePath();
							}
						}
					}
				}
				else{
					ctx.beginPath();
					ctx.fillStyle = "#ffc107";
					ctx.fillRect(canvas.width/2 - 250, canvas.height/2 - 50, 100, 100);
					ctx.fillRect(canvas.width/2 - 50, canvas.height/2 - 50, 100, 100);
					ctx.fillRect(canvas.width/2 + 150, canvas.height/2 - 50, 100, 100);
					ctx.closePath();
					
					ctx.beginPath();
					ctx.font = "70px Arial";
					ctx.fillStyle = "#BA4A00";
					ctx.textAlign = "center";
					ctx.fillText("Select board size",  canvas.width/2, canvas.height/2 - 150);
					ctx.fillText("9",  canvas.width/2 - 200, canvas.height/2 + 20);
					ctx.fillText("13", canvas.width/2      , canvas.height/2 + 20);
					ctx.fillText("19", canvas.width/2 + 200, canvas.height/2 + 20);
					ctx.closePath();
				}
				
				
				// when game is over
				if(winner > 0 && winner < 3){
					
					box[1] = (200 + (20 * teamColor[winner].length));
					box[2] = (50 + 20 * (score[winner].toString().length + score[3 - winner].toString().length));
					
					ctx.fillStyle = teamColor[winner];
					ctx.fillRect(canvas.width/2 - box[1], 140, box[1]*2, 70);
					ctx.fillRect(canvas.width/2 - box[2], 240, box[2]*2, 70);

					ctx.font = "70px Arial";
					ctx.fillStyle = teamColor[3 - winner];
					ctx.textAlign = "center";
					ctx.fillText(teamColor[winner] + " Team wins!", canvas.width/2, 200);
					ctx.fillText(score[winner] + " - " + score[3 - winner], canvas.width/2, 300);
				}
				if(winner == 3){
                    
					box[1] = 150;
					box[2] = (50 + 20 * (score[1].toString().length + score[2].toString().length));
					
					ctx.fillStyle = teamColor[2];
					ctx.fillRect(canvas.width/2 - box[1], 140, box[1]*2, 70);
					ctx.fillRect(canvas.width/2 - box[2], 240, box[2]*2, 70);
					
					ctx.font = "70px Arial";
					ctx.fillStyle = teamColor[1];
					ctx.textAlign = "center";
					ctx.fillText("It's a Tie!", canvas.width/2, 200);
					ctx.fillText(score[1] + " - " + score[2], canvas.width/2, 300);
				}
				
				
				
				
				setTimeout(draw, 50);
			}
			draw();
			
		</SCRIPT>
	</body>
</html>
