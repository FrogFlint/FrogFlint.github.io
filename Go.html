<!DOCTYPE html>
<html>

<head>

	<style>
		* {
			padding: 0;
			margin: 0;
		}
		
		canvas {
			background: goldenrod;
			display: block;
			margin: 0 auto;
		}
	</style>

<title>The game of Go</title>
</head>

<body>

	<canvas id="myCanvas" width="700" height="620"></canvas>

	<body style="background-color:saddleBrown;">

		<SCRIPT LANGUAGE="JavaScript">
			
			
			var canvas = document.getElementById("myCanvas");
			var ctx = canvas.getContext("2d");
			
			
			var boardSize = 9; //9,13,19
			var scale = 600/boardSize;
			
			
			var index1 = 0;
			var index2 = 0;
			
			var tile = [[]];
			var tilesMarked = 0;
			var blobCheck = 0;
			
			var selected = {x:0,y:0}
			
			
			var turn = 1;
			var teamColor = [0,"black","white"]
			
			
			
			//keys
			var left = 0;
			var right = 0;
			var up = 0;
			var down = 0;
			var space = 0;
			
			
			/*
			var mod = function (n, m) {
		  		var remain = n % m;
		  		return Math.floor(remain >= 0 ? remain : remain + m);
			};*/
			
			
			
			for(index1 = 0; index1 < boardSize; index1++){
				tile[index1] = [];
				for(index2 = 0; index2 < boardSize; index2++){
					
					tile[index1][index2] = {
						stone: 0,
						blob: 0,
						safe:0
					}
				}
			}
			
			
			
			
			
			
			function getMousePos(canvas, evt) {
			    var rect = canvas.getBoundingClientRect();
			    return {
			      x: Math.floor(((evt.clientX - rect.left) - 50)/scale),
			      y: Math.floor(((evt.clientY - rect.top) - 10)/scale)
			    };
			}
			
			
			function addStone(evt) {
				
				selected = getMousePos(canvas, evt);
				
				
				if(tile[selected.x][selected.y].stone == 0){
					tile[selected.x][selected.y].stone = turn;
					
					tilesMarked = 0;
					
					if(selected.x < (boardSize - 1) &&
					   	tile[selected.x][selected.y].stone + tile[selected.x + 1][selected.y].stone == 3 &&
					  	tile[selected.x + 1][selected.y].blob == 0){
						tile[selected.x + 1][selected.y].blob = 1;
						tilesMarked += 1;}
					if(selected.x > 0 &&
					   	tile[selected.x][selected.y].stone + tile[selected.x - 1][selected.y].stone == 3 &&
					  	tile[selected.x - 1][selected.y].blob == 0){
						tile[selected.x - 1][selected.y].blob = 1;
						tilesMarked += 1;}
					if(selected.y < (boardSize - 1) &&
					   	tile[selected.x][selected.y].stone + tile[selected.x][selected.y + 1].stone == 3 &&
					  	tile[selected.x][selected.y + 1].blob == 0){
						tile[selected.x][selected.y + 1].blob = 1;
						tilesMarked += 1;}
					if(selected.y > 0 &&
					   	tile[selected.x][selected.y].stone + tile[selected.x][selected.y - 1].stone == 3 &&
					  	tile[selected.x][selected.y - 1].blob == 0){
						tile[selected.x][selected.y - 1].blob = 1;
						tilesMarked += 1;}
					
					blobCheck = 0;
					if(tilesMarked > 0){blobCheck = 1;}
					
					while(tilesMarked > 0){
						tilesMarked = 0;
						
						for(index1 = 0; index1 < boardSize; index1++){
							for(index2 = 0; index2 < boardSize; index2++){
								
								if(index1 < (boardSize - 1) && tile[index1][index2].stone == tile[index1+1][index2].stone &&
								   tile[index1  ][index2].blob == 1 &&
								   tile[index1+1][index2].blob == 0){
									tile[index1+1][index2].blob = 1;
									tilesMarked += 1;
								}
								if(index1 > 0 && tile[index1][index2].stone == tile[index1-1][index2].stone &&
								   tile[index1  ][index2].blob == 1 &&
								   tile[index1-1][index2].blob == 0){
									tile[index1-1][index2].blob = 1;
									tilesMarked += 1;
								}
								if(index2 < (boardSize - 1) && tile[index1][index2].stone == tile[index1][index2+1].stone &&
								   tile[index1][index2  ].blob == 1 &&
								   tile[index1][index2+1].blob == 0){
									tile[index1][index2+1].blob = 1;
									tilesMarked += 1;
								}
								if(index2 > 0 && tile[index1][index2].stone == tile[index1][index2-1].stone &&
								   tile[index1][index2  ].blob == 1 &&
								   tile[index1][index2-1].blob == 0){
									tile[index1][index2-1].blob = 1;
									tilesMarked += 1;
								}
							}
						}
						if(tilesMarked > 0){blobCheck = 1;}
					}
					
					if(blobCheck == 1){
						for(index1 = 0; index1 < boardSize; index1++){
							for(index2 = 0; index2 < boardSize; index2++){
								
								if(index1 < (boardSize - 1) && tile[index1][index2].stone == 0 &&
								   tile[index1+1][index2].blob == 1){
									tile[index1+1][index2].safe = 1;
									tilesMarked += 1;
								}
								if(index1 > 0 && tile[index1][index2].stone == 0 &&
								   tile[index1-1][index2].blob == 1){
									tile[index1-1][index2].safe = 1;
									tilesMarked += 1;
								}
								if(index2 < (boardSize - 1) && tile[index1][index2].stone == 0 &&
								   tile[index1][index2+1].blob == 1){
									tile[index1][index2+1].safe = 1;
									tilesMarked += 1;
								}
								if(index2 > 0 && tile[index1][index2].stone == 0 &&
								   tile[index1][index2-1].blob == 1){
									tile[index1][index2-1].safe = 1;
									tilesMarked += 1;
								}
							}
						}
					}
					
					while(tilesMarked > 0){
						tilesMarked = 0;
						
						for(index1 = 0; index1 < boardSize; index1++){
							for(index2 = 0; index2 < boardSize; index2++){
								
								if(index1 < (boardSize - 1) && tile[index1][index2].stone == tile[index1+1][index2].stone &&
								   tile[index1  ][index2].safe == 1 &&
								   tile[index1+1][index2].safe == 0){
									tile[index1+1][index2].safe = 1;
									tilesMarked += 1;
								}
								if(index1 > 0 && tile[index1][index2].stone == tile[index1-1][index2].stone &&
								   tile[index1  ][index2].safe == 1 &&
								   tile[index1-1][index2].safe == 0){
									tile[index1-1][index2].safe = 1;
									tilesMarked += 1;
								}
								if(index2 < (boardSize - 1) && tile[index1][index2].stone == tile[index1][index2+1].stone &&
								   tile[index1][index2  ].safe == 1 &&
								   tile[index1][index2+1].safe == 0){
									tile[index1][index2+1].safe = 1;
									tilesMarked += 1;
								}
								if(index2 > 0 && tile[index1][index2].stone == tile[index1][index2-1].stone &&
								   tile[index1][index2  ].safe == 1 &&
								   tile[index1][index2-1].safe == 0){
									tile[index1][index2-1].safe = 1;
									tilesMarked += 1;
								}
							}
						}
					}
					
					for(index1 = 0; index1 < boardSize; index1++){
						for(index2 = 0; index2 < boardSize; index2++){
							
							if(tile[index1][index2].blob == 1 && tile[index1][index2].safe == 0){
								tile[index1][index2].stone = 0;
							}
							tile[index1][index2].blob = 0;
							tile[index1][index2].safe = 0;
						}
					}
					
					
					
					
					
					
					turn = turn % 2 + 1;
				}
				
			}
			
			
			
			function draw(evt) {
				
				ctx.clearRect(0,0,canvas.width,canvas.height);
				
				
				
				
				
				/*
				document.addEventListener("keydown", keyDownHandler, false);
				document.addEventListener("keyup", keyUpHandler, false);
				function keyDownHandler(e) {
					
					if(e.keyCode == 37){left = 1;}
					if(e.keyCode == 39){right = 1;}
					if(e.keyCode == 40){down = 1;}
					if(e.keyCode == 38){up = 1;}
					if(e.keyCode == 32){space = 1;}
					
					
				}*/
				
				
				
				document.addEventListener("click", addStone);
				
				window.oncontextmenu = function(){return false;}
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				ctx.beginPath();
				ctx.fillStyle = teamColor[turn];
				ctx.fillRect(20, 200, 10, 220);
				ctx.fillRect(670, 200, 10, 220);
				ctx.fill();
				ctx.closePath();
				
				
				// draw the squares
				for(index1 = 0; index1 < boardSize; index1++){
					
					ctx.beginPath();
					ctx.moveTo(index1*scale + scale/2 +50, 10  + scale/2);
					ctx.lineTo(index1*scale + scale/2 +50, 610 - scale/2);
					ctx.stroke();
					
					ctx.beginPath();
					ctx.moveTo(50  + scale/2, index1*scale + scale/2 + 10);
					ctx.lineTo(650 - scale/2, index1*scale + scale/2 + 10);
					ctx.stroke();
					
				}
				
				
				
				// draw the squares
				for(index1 = 0; index1 < boardSize; index1++){
					for(index2 = 0; index2 < boardSize; index2++){
						
						
						if(tile[index1][index2].stone != 0){
							ctx.beginPath();
							ctx.arc(index1*scale + scale/2 +50, index2*scale + scale/2 +10, scale*2/5, 0, Math.PI * 2);
							ctx.fillStyle = teamColor[tile[index1][index2].stone];
							ctx.fill();
							ctx.closePath();
						}
					}
				}
				
				
				
       				setTimeout(draw, 10);
			}    
			draw();
        		
   		 </SCRIPT>
	</body>
</html>
