
<!DOCTYPE html>
<html>

<head>

	<style>
		* {
			padding: 0;
			margin: 0;
		}
		
		canvas {
			background: goldenrod;
			display: block;
			margin: 0 auto;
		}
	</style>

<title>The game of Go</title>
</head>

<body>

	<canvas id="myCanvas" width="700" height="620"></canvas>

	<body style="background-color:saddleBrown;">

		<SCRIPT LANGUAGE="JavaScript">
			
			
			var canvas = document.getElementById("myCanvas");
			var ctx = canvas.getContext("2d");
			
			
			var sizeSelect = 1;
			
			var boardSize = 5; //9,13,19
			var scale = 600/boardSize;
			
			
			var index1 = 0;
			var index2 = 0;
			var index3 = 0;
			var adjacent = [{x:1,y:0},{x:0,y:1},{x:-1,y:0},{x:0,y:-1}];
			
			var tile = [[]];
			var tilesMarked = 0;
			var blobCheck = 0;
			
			var selected = {x:0,y:0};
			
			
			var lastTile = [[]];
			var undid = 0;
			
			
			var turn = 1;
			var teamColor = ["","Black","White"];
			
			var winner = 0;
			var score = ["",0,0];
			
			var box = [0,0]
			
			
			//keys
			/*
			var left = 0;
			var right = 0;
			var up = 0;
			var down = 0;
			var space = 0;*/
			
			
			/*
			var mod = function (n, m) {
				var remain = n % m;
				return Math.floor(remain >= 0 ? remain : remain + m);
			};*/
			
			
			
			function createBoard(){
				for(index1 = 0; index1 < boardSize; index1++){
					tile[index1] = [];
					for(index2 = 0; index2 < boardSize; index2++){
						
						tile[index1][index2] = {
							stone: 0,
							blob: 0,
							safe:0,
							
							scoreBlob1:0,
							scoreBlob2:0
						}
					}
				}
				for(index1 = 0; index1 < boardSize; index1++){
					lastTile[index1] = [];
					for(index2 = 0; index2 < boardSize; index2++){
						lastTile[index1][index2] = {stone: 0}
					}
				}
				sizeSelect = 0;
			}
			
			
			
			
			
			function getMousePos(canvas, evt) {
			    var rect = canvas.getBoundingClientRect();
			    return {
			      x: Math.floor(((evt.clientX - rect.left) - 50)/scale),
			      y: Math.floor(((evt.clientY - rect.top) - 10)/scale)
			    };
			}
			
			function spreadTile(type, loop){
				
			}
			
			
			function addStone(evt) {
				
				
				
				if(sizeSelect == 1){
					
					var rect = canvas.getBoundingClientRect();
					selected = {x: Math.floor(evt.clientX - rect.left), y: Math.floor(evt.clientY - rect.top)}
					
					if(selected.y >= canvas.height/2 - 50 && selected.y <= canvas.height/2 + 50){
						boardSize = Math.floor((selected.x - canvas.width/2 + 250)/100);
						switch(boardSize){
						    case 0:
							boardSize = 9;
							scale = 600/boardSize;
							createBoard();
							break;
						    case 2:
							boardSize = 13;
							scale = 600/boardSize;
							createBoard();
							break;
						    case 4:
							boardSize = 19;
							scale = 600/boardSize;
							createBoard();
							break;
						    default:
							break;
						}
					}
				}
				else{
				
				selected = getMousePos(canvas, evt);
				
				if(selected.x >= 0 && selected.x < boardSize && selected.y >= 0 && selected.y < boardSize
				&& tile[selected.x][selected.y].stone == 0  &&  winner == 0){
					
					//save board
					for(index1 = 0; index1 < boardSize; index1++){
						for(index2 = 0; index2 < boardSize; index2++){
							lastTile[index1][index2].stone = tile[index1][index2].stone;
						}
					}
					undid = 0;
					
					
					tile[selected.x][selected.y].stone = turn;
					
					tilesMarked = 0;
					
					for(index3 = 0;index3 < 4;index3++){
						if(selected.x + adjacent[index3].x >= 0 && selected.x + adjacent[index3].x < boardSize &&
						   selected.y + adjacent[index3].y >= 0 && selected.y + adjacent[index3].y < boardSize &&
						   tile[selected.x][selected.y].stone + tile[selected.x + adjacent[index3].x][selected.y + adjacent[index3].y].stone == 3 &&
						   tile[selected.x + adjacent[index3].x][selected.y + adjacent[index3].y].blob == 0){
							tile[selected.x + adjacent[index3].x][selected.y + adjacent[index3].y].blob = 1;
							tilesMarked += 1;
						}
					}
					
					blobCheck = 0;
					if(tilesMarked > 0){blobCheck = 1;}
					
					while(tilesMarked > 0){
						tilesMarked = 0;
						
						for(index1 = 0; index1 < boardSize; index1++){
							for(index2 = 0; index2 < boardSize; index2++){
								
								for(index3 = 0;index3 < 4;index3++){
									if(index1 + adjacent[index3].x >= 0 && index1 + adjacent[index3].x < boardSize &&
									   index2 + adjacent[index3].y >= 0 && index2 + adjacent[index3].y < boardSize &&
									   tile[index1][index2].stone == tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].stone &&
									   tile[index1][index2].blob == 1 &&
									   tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].blob == 0){
										tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].blob = 1;
										tilesMarked += 1;
									}
								}
							}
						}
						if(tilesMarked > 0){blobCheck = 1;}
					}
					
					if(blobCheck == 1){
						for(index1 = 0; index1 < boardSize; index1++){//bfhbhukgbersugbsbvsd
							for(index2 = 0; index2 < boardSize; index2++){
								
								for(index3 = 0;index3 < 4;index3++){
									if(index1 + adjacent[index3].x >= 0 && index1 + adjacent[index3].x < boardSize &&
									   index2 + adjacent[index3].y >= 0 && index2 + adjacent[index3].y < boardSize &&
									   tile[index1][index2].stone == 0 && tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].blob == 1){
										tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].safe = 1;
										tilesMarked += 1;
									}
								}
							}
						}
					}
					
					while(tilesMarked > 0){
						tilesMarked = 0;
						
						for(index1 = 0; index1 < boardSize; index1++){
							for(index2 = 0; index2 < boardSize; index2++){
								
								for(index3 = 0;index3 < 4;index3++){
									if(index1 + adjacent[index3].x >= 0 && index1 + adjacent[index3].x < boardSize &&
									   index2 + adjacent[index3].y >= 0 && index2 + adjacent[index3].y < boardSize &&
									   tile[index1][index2].stone == tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].stone &&
									   tile[index1][index2].safe == 1 && tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].safe == 0){
										tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].safe = 1;
										tilesMarked += 1;
									}
								}
							}
						}
					}
					
					for(index1 = 0; index1 < boardSize; index1++){
						for(index2 = 0; index2 < boardSize; index2++){
							
							if(tile[index1][index2].blob == 1 && tile[index1][index2].safe == 0){
								tile[index1][index2].stone = 0;
							}
							tile[index1][index2].blob = 0;
							tile[index1][index2].safe = 0;
						}
					}
					
					
					//===============================================================================================================================================
					
					
					
					tile[selected.x][selected.y].blob = 1;
					blobCheck = 1;
					tilesMarked = 1;
					
					while(tilesMarked > 0){
						tilesMarked = 0;
						
						for(index1 = 0; index1 < boardSize; index1++){
							for(index2 = 0; index2 < boardSize; index2++){ //very problematic
								/*
								for(index3 = 0;index3 < 4;index3++){
									if(index1 + adjacent[index3].x >= 0 && index1 + adjacent[index3].x < boardSize &&
									   index2 + adjacent[index3].y >= 0 && index2 + adjacent[index3].y < boardSize &&
									   //tile[index1][index2].stone == tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].stone &&
									   tile[index1][index2].blob == 1 && tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].blob == 0){
										tile[index1 + adjacent[index3].x][index2 + adjacent[index3].y].safe = 1;
										tilesMarked += 1;
									}
								}*/
								/*
								if(index1 < (boardSize - 1) && tile[index1][index2].stone == tile[index1+1][index2].stone &&
								   tile[index1  ][index2].blob == 1 &&
								   tile[index1+1][index2].blob == 0){
									tile[index1+1][index2].blob = 1;
									tilesMarked += 1;
								}
								if(index1 > 0 && tile[index1][index2].stone == tile[index1-1][index2].stone &&
								   tile[index1  ][index2].blob == 1 &&
								   tile[index1-1][index2].blob == 0){
									tile[index1-1][index2].blob = 1;
									tilesMarked += 1;
								}
								if(index2 < (boardSize - 1) && tile[index1][index2].stone == tile[index1][index2+1].stone &&
								   tile[index1][index2  ].blob == 1 &&
								   tile[index1][index2+1].blob == 0){
									tile[index1][index2+1].blob = 1;
									tilesMarked += 1;
								}
								if(index2 > 0 && tile[index1][index2].stone == tile[index1][index2-1].stone &&
								   tile[index1][index2  ].blob == 1 &&
								   tile[index1][index2-1].blob == 0){
									tile[index1][index2-1].blob = 1;
									tilesMarked += 1;
								}*/
							}
						}
						if(tilesMarked > 0){blobCheck = 1;}
					}
					
					if(blobCheck == 1){
						for(index1 = 0; index1 < boardSize; index1++){
							for(index2 = 0; index2 < boardSize; index2++){
								
								
								
								if(index1 < (boardSize - 1) && tile[index1][index2].stone == 0 &&
								   tile[index1+1][index2].blob == 1){
									tile[index1+1][index2].safe = 1;
									tilesMarked += 1;
								}
								if(index1 > 0 && tile[index1][index2].stone == 0 &&
								   tile[index1-1][index2].blob == 1){
									tile[index1-1][index2].safe = 1;
									tilesMarked += 1;
								}
								if(index2 < (boardSize - 1) && tile[index1][index2].stone == 0 &&
								   tile[index1][index2+1].blob == 1){
									tile[index1][index2+1].safe = 1;
									tilesMarked += 1;
								}
								if(index2 > 0 && tile[index1][index2].stone == 0 &&
								   tile[index1][index2-1].blob == 1){
									tile[index1][index2-1].safe = 1;
									tilesMarked += 1;
								}
							}
						}
					}
					
					while(tilesMarked > 0){
						tilesMarked = 0;
						
						for(index1 = 0; index1 < boardSize; index1++){
							for(index2 = 0; index2 < boardSize; index2++){
								
								if(index1 < (boardSize - 1) && tile[index1][index2].stone == tile[index1+1][index2].stone &&
								   tile[index1  ][index2].safe == 1 &&
								   tile[index1+1][index2].safe == 0){
									tile[index1+1][index2].safe = 1;
									tilesMarked += 1;
								}
								if(index1 > 0 && tile[index1][index2].stone == tile[index1-1][index2].stone &&
								   tile[index1  ][index2].safe == 1 &&
								   tile[index1-1][index2].safe == 0){
									tile[index1-1][index2].safe = 1;
									tilesMarked += 1;
								}
								if(index2 < (boardSize - 1) && tile[index1][index2].stone == tile[index1][index2+1].stone &&
								   tile[index1][index2  ].safe == 1 &&
								   tile[index1][index2+1].safe == 0){
									tile[index1][index2+1].safe = 1;
									tilesMarked += 1;
								}
								if(index2 > 0 && tile[index1][index2].stone == tile[index1][index2-1].stone &&
								   tile[index1][index2  ].safe == 1 &&
								   tile[index1][index2-1].safe == 0){
									tile[index1][index2-1].safe = 1;
									tilesMarked += 1;
								}
							}
						}
					}
					
					for(index1 = 0; index1 < boardSize; index1++){
						for(index2 = 0; index2 < boardSize; index2++){
							
							if(tile[index1][index2].blob == 1 && tile[index1][index2].safe == 0){
								tile[index1][index2].stone = 0;
							}
							tile[index1][index2].blob = 0;
							tile[index1][index2].safe = 0;
						}
					}
					
					
					
					
					
					
					
					
					turn = turn % 2 + 1;
				}
				}
			}
			
			function countScore() {
				
				for(index1 = 0; index1 < boardSize; index1++){
					for(index2 = 0; index2 < boardSize; index2++){
						tile[index1][index2].scoreBlob1 = 0;
						tile[index1][index2].scoreBlob2 = 0;
						if(tile[index1][index2].stone == 1){tile[index1][index2].scoreBlob1 = 1;}
						if(tile[index1][index2].stone == 2){tile[index1][index2].scoreBlob2 = 1;}
					}
				}
				
				
				
				tilesMarked = 1; 
				
				while(tilesMarked > 0){
					tilesMarked = 0;
					for(index1 = 0; index1 < boardSize; index1++){
						for(index2 = 0; index2 < boardSize; index2++){
							
							if(tile[index1][index2].stone == 0){
								if(index1 < (boardSize - 1) && tile[index1+1][index2].scoreBlob1 > tile[index1][index2].scoreBlob1){
									tile[index1][index2].scoreBlob1 = 1;
									tilesMarked ++;
								}
								if(index1 > 0 && tile[index1-1][index2].scoreBlob1 > tile[index1][index2].scoreBlob1){
									tile[index1][index2].scoreBlob1 = 1;
									tilesMarked ++;
								}
								if(index2 < (boardSize - 1) && tile[index1][index2+1].scoreBlob1 > tile[index1][index2].scoreBlob1){
									tile[index1][index2].scoreBlob1 = 1;
									tilesMarked ++;
								}
								if(index2 > 0 && tile[index1][index2-1].scoreBlob1 > tile[index1][index2].scoreBlob1){
									tile[index1][index2].scoreBlob1 = 1;
									tilesMarked ++;
								}
								//======================================================================
								if(index1 < (boardSize - 1) && tile[index1+1][index2].scoreBlob2 > tile[index1][index2].scoreBlob2){
									tile[index1][index2].scoreBlob2 = 1;
									tilesMarked ++;
								}
								if(index1 > 0 && tile[index1-1][index2].scoreBlob2 > tile[index1][index2].scoreBlob2){
									tile[index1][index2].scoreBlob2 = 1;
									tilesMarked ++;
								}
								if(index2 < (boardSize - 1) && tile[index1][index2+1].scoreBlob2 > tile[index1][index2].scoreBlob2){
									tile[index1][index2].scoreBlob2 = 1;
									tilesMarked ++;
								}
								if(index2 > 0 && tile[index1][index2-1].scoreBlob2 > tile[index1][index2].scoreBlob2){
									tile[index1][index2].scoreBlob2 = 1;
									tilesMarked ++;
								}
							}
						}
					}
				}
				score[1] = 0;
				score[2] = 0;
				for(index1 = 0; index1 < boardSize; index1++){
					for(index2 = 0; index2 < boardSize; index2++){
						
						if(tile[index1][index2].scoreBlob1 + tile[index1][index2].scoreBlob2 == 1){
							score[1] += tile[index1][index2].scoreBlob1;
							score[2] += tile[index1][index2].scoreBlob2;
						}
					}
				}
				if(score[1] + score[2] > 0.9 * (boardSize*boardSize)){
					if (score[1] > score[2]){winner = 1;}
					if (score[1] < score[2]){winner = 2;}
					if (score[1] ==score[2]){winner = 3;}
				}
				
			}
			
			
			
			function draw(evt) {
				
				ctx.clearRect(0,0,canvas.width,canvas.height);
				
				
				
				
				
				
				document.addEventListener("keydown", keyDownHandler, false);
				//document.addEventListener("keyup", keyUpHandler, false);
				function keyDownHandler(e) {
					
					if(e.keyCode == 87){countScore();}
					
					if(e.keyCode == 85 && undid == 0){
						for(index1 = 0; index1 < boardSize; index1++){
							for(index2 = 0; index2 < boardSize; index2++){
								tile[index1][index2].stone = lastTile[index1][index2].stone;
							}
						}
						turn = turn % 2 + 1;
						undid = 1;
					}
					
					
				}
				
				
				
				document.addEventListener("click", addStone);
				
				window.oncontextmenu = function(){return false;}
				
				
				
				
				
				
				
				
				
				if(sizeSelect == 0){
					
					ctx.beginPath();
					ctx.fillStyle = teamColor[turn];
					ctx.fillRect(20, 200, 10, 220);
					ctx.fillRect(670, 200, 10, 220);
					ctx.fill();
					ctx.closePath();
					
					
					// draw the squares
					for(index1 = 0; index1 < boardSize; index1++){
						
						ctx.beginPath();
						ctx.moveTo(index1*scale + scale/2 +50, 10  + scale/2);
						ctx.lineTo(index1*scale + scale/2 +50, 610 - scale/2);
						ctx.stroke();
						
						ctx.beginPath();
						ctx.moveTo(50  + scale/2, index1*scale + scale/2 + 10);
						ctx.lineTo(650 - scale/2, index1*scale + scale/2 + 10);
						ctx.stroke();
					}
					
					// draw the stones and dot markers
					for(index1 = 0; index1 < boardSize; index1++){
						for(index2 = 0; index2 < boardSize; index2++){
							
							//dots
							if(index1 == (boardSize - 1)/2 && index2 == index1 ||
							   boardSize >= 13 && (index1 == 3 || index1 == boardSize - 4) && (index2 == 3 || index2 == boardSize - 4) ||
							   boardSize >= 19 && (((index1 == 3 || index1 == boardSize - 4) && index2 == (boardSize - 1)/2) ||
							                       ((index2 == 3 || index2 == boardSize - 4) && index1 == (boardSize - 1)/2)
							                      )){
								ctx.beginPath();
								ctx.arc(index1*scale + scale/2 +50, index2*scale + scale/2 +10, scale*0.07, 0, Math.PI * 2);
								ctx.fillStyle = "black";
								ctx.fill();
								ctx.closePath();
							}
							
							//stones
							if(tile[index1][index2].stone > 0){
								ctx.beginPath();
								ctx.arc(index1*scale + scale/2 +50, index2*scale + scale/2 +10, scale*2/5, 0, Math.PI * 2);
								ctx.fillStyle = teamColor[tile[index1][index2].stone];
								ctx.fill();
								ctx.closePath();
							}
						}
					}
				}
				else{
					ctx.beginPath();
					ctx.fillStyle = "#ffc107";
					ctx.fillRect(canvas.width/2 - 250, canvas.height/2 - 50, 100, 100);
					ctx.fillRect(canvas.width/2 - 50, canvas.height/2 - 50, 100, 100);
					ctx.fillRect(canvas.width/2 + 150, canvas.height/2 - 50, 100, 100);
					ctx.closePath();
					
					ctx.beginPath();
					ctx.font = "70px Arial";
					ctx.fillStyle = "#BA4A00";
					ctx.textAlign = "center";
					ctx.fillText("Select board size",  canvas.width/2, canvas.height/2 - 150);
					ctx.fillText("9",  canvas.width/2 - 200, canvas.height/2 + 20);
					ctx.fillText("13", canvas.width/2      , canvas.height/2 + 20);
					ctx.fillText("19", canvas.width/2 + 200, canvas.height/2 + 20);
					ctx.closePath();
				}
				
				
				// when game is over
				if(winner > 0 && winner < 3){
					
					box[1] = (200 + (20 * teamColor[winner].length));
					box[2] = (50 + 20 * (score[winner].toString().length + score[3 - winner].toString().length));
					
					ctx.fillStyle = teamColor[3 - winner];
					ctx.fillRect(canvas.width/2 - box[1], 140, box[1]*2, 70);
					ctx.fillRect(canvas.width/2 - box[2], 240, box[2]*2, 70);

					ctx.font = "70px Arial";
					ctx.fillStyle = teamColor[winner];
					ctx.textAlign = "center";
					ctx.fillText(teamColor[winner] + " Team wins!", canvas.width/2, 200);
					ctx.fillText(score[winner] + " - " + score[3 - winner], canvas.width/2, 300);
				}
				if(winner == 3){
                    
					box[1] = 150;
					box[2] = (50 + 20 * (score[1].toString().length + score[2].toString().length));
					
					ctx.fillStyle = teamColor[2];
					ctx.fillRect(canvas.width/2 - box[1], 140, box[1]*2, 70);
					ctx.fillRect(canvas.width/2 - box[2], 240, box[2]*2, 70);
					
					ctx.font = "70px Arial";
					ctx.fillStyle = teamColor[1];
					ctx.textAlign = "center";
					ctx.fillText("It's a Tie!", canvas.width/2, 200);
					ctx.fillText(score[1] + " - " + score[2], canvas.width/2, 300);
				}
				
				
				
				
				setTimeout(draw, 10);
			}
			draw();
			
		</SCRIPT>
	</body>
</html>
